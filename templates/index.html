{% extends "base.html" %}

{% block content %}
<div class="hero">
    <div class="container">
        <h2>Byenveni nan Glory2yahPub</h2>
        <p>FE PIBLISITE W SOU FACEBOOK AK INSTAGRAM A PATI 1000G POU YON SEMEN,kliyan w yo ap konekte avè w  atravè WhatsApp ou</p>
        <a href="{{ url_for('submit_ad') }}" class="btn btn-gold"><i class="fas fa-bullhorn"></i> Klika pou w fè piblisite w</a>
    </div>
</div>

{% if batch %}
<div class="batch-section">
    <div class="container">
        <h3>Dènye Gwoup Piblisite</h3>
        
        <!-- Carousel Container -->
        <div class="carousel-wrapper">
            <button class="carousel-btn carousel-prev" onclick="moveCarousel(-1)">
                <i class="fas fa-chevron-left"></i>
            </button>
            
            <div class="carousel-track-container">
                <div class="carousel-track" id="carouselTrack">
                    {% for ad in ads %}
                    <div class="carousel-card">
                        <div class="whatsapp-ad-card" onclick="showAdModal('{{ ad.ad_id }}', '{{ ad.images }}', '{{ ad.video }}', '{{ ad.media_type }}', '{{ ad.title }}', '{{ ad.description }}', '{{ ad.price_gkach }}')">
                            <div class="ad-image">
                                {% if ad.media_type == 'video' %}
                                <video controls loop playsinline style="width: 100%; height: 100%; object-fit: cover;">
                                    <source src="{{ url_for('static', filename='uploads/' + ad.video) }}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                                {% else %}
                                <img src="{{ url_for('static', filename='uploads/' + ad.images.split(',')[0]) }}"
                                     alt="Piblisite Imaj">
                                {% endif %}
                            </div>
                            <div class="ad-content">
                                <div class="ad-text">
                                    <h4>{{ ad.title }}</h4>
                                    <p>{{ ad.description }}</p>
                                </div>
                                <div class="ad-actions">
                                    {% if ad.ad_type == 'sell' %}
                                    <p><strong>Pri: {{ ad.price_gkach }} Gkach</strong></p>
                                    <a href="{{ url_for('shopping_cart', ad_id=ad.ad_id) }}" class="btn btn-blue btn-icon" onclick="event.stopPropagation()">
                                        <i class="fas fa-shopping-cart"></i>
                                    </a>
                                    {% else %}
                                    <p><strong>PIBLIYE SELMAN</strong></p>
                                    <a href="https://wa.me/{{ ad.user_whatsapp.lstrip('+') if ad.user_whatsapp else '' }}?text={{ ('Mwen enterese ak ' + (ad.title or 'piblisite sa') + ' w lan') | urlencode }}"
                                       class="btn btn-whatsapp btn-icon" target="_blank" onclick="event.stopPropagation()">
                                        <i class="fab fa-whatsapp"></i>
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <button class="carousel-btn carousel-next" onclick="moveCarousel(1)">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- Carousel Indicators -->
        <div class="carousel-indicators" id="carouselIndicators"></div>
        
        <div style="text-align: center; margin-top: 20px;">
            <a href="{{ url_for('view_batch', batch_id=batch.batch_id) }}" class="btn btn-blue">Wè Gwoup Konplè</a>
        </div>
    </div>
</div>
{% endif %}

<div class="features">
    <div class="container">
        <div class="feature-grid">
            <div class="feature">
                <h3>Kliyan w yo ap kontakte w pa WhatsApp</h3>
                <p>Rete konekte ak kliyan w fasilite w negosye pi byen</p>
            </div>
            <div class="feature">
                <h3>Piblisite w la ap nan Sistem Gwoup</h3>
                <p>Piblisite ak Kalite se fos tout bon biznis </p>
            </div>
            <div class="feature">
                <h3>Ou ka jwenn Rekonpans si zanmi w Klike link lan</h3>
                <p>Ou ka benefisye pwochen piblisite w la gratis. Kontakte Admin pou w ka benefisye l</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal for full ad view -->
<div id="ad-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeAdModal()">&times;</span>
        <div id="modal-images" class="modal-images"></div>
        <div id="modal-description" class="modal-description"></div>
    </div>
</div>

<style>
/* Batch Section Styles */
.batch-section {
    padding: 40px 0;
    background: #f8f9fa;
}

.batch-section h3 {
    text-align: center;
    margin-bottom: 30px;
    font-size: 28px;
    color: #333;
}

/* Carousel Wrapper */
.carousel-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    gap: 20px;
    margin: 0 auto;
    max-width: 1200px;
}

.carousel-track-container {
    overflow: hidden;
    flex: 1;
}

.carousel-track {
    display: flex;
    transition: transform 0.5s ease-in-out;
    gap: 20px;
}

.carousel-card {
    min-width: 300px;
    flex-shrink: 0;
}

/* Carousel Buttons */
.carousel-btn {
    background: rgba(0, 0, 0, 0.5);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s ease;
    z-index: 10;
}

.carousel-btn:hover {
    background: rgba(0, 0, 0, 0.8);
}

.carousel-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

/* Carousel Indicators */
.carousel-indicators {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
}

.indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #ddd;
    cursor: pointer;
    transition: background 0.3s ease;
}

.indicator.active {
    background: #007bff;
}

/* Ad Card Styles (same as Achte page) */
.whatsapp-ad-card {
    border: 1px solid #ddd;
    border-radius: 12px;
    overflow: hidden;
    background: white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 400px;
}

.whatsapp-ad-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
}

.ad-image {
    flex: 0 0 60%;
    overflow: hidden;
}

.ad-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.whatsapp-ad-card:hover .ad-image img {
    transform: scale(1.05);
}

.ad-content {
    flex: 0 0 40%;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
}

.ad-text {
    padding: 10px;
    flex-grow: 0;
}

.ad-text h4 {
    margin: 0 0 5px 0;
    font-size: 16px;
    font-weight: bold;
    color: #333;
}

.ad-text p {
    margin: 0 0 5px 0;
    font-size: 12px;
    line-height: 1.3;
    color: #666;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.ad-actions {
    padding: 10px;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: 5px;
    align-items: center;
    justify-content: space-between;
}

.btn-icon {
    padding: 8px 12px;
    font-size: 16px;
}

.btn-whatsapp {
    background-color: #25d366;
    color: white;
}

.btn-whatsapp:hover {
    background-color: #128c7e;
}

/* Modal styles */
.modal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 20px;
    border-radius: 8px;
    width: 90%;
    max-width: 600px;
    position: relative;
}

.close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: #f00;
}

.modal-images {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
}

.modal-images img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
}

.modal-description h3 {
    margin-top: 0;
}

.modal-description p {
    margin: 10px 0;
    line-height: 1.6;
}

/* Responsive Design */
@media (max-width: 768px) {
    .batch-section h3 {
        font-size: 22px;
        margin-bottom: 20px;
    }
    
    .carousel-wrapper {
        gap: 10px;
    }
    
    .carousel-card {
        min-width: 100%;
    }
    
    .carousel-btn {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
    
    .whatsapp-ad-card {
        height: auto;
        min-height: 350px;
        max-width: 100%;
    }
    
    .ad-image {
        flex: 0 0 50%;
    }
    
    .ad-content {
        flex: 0 0 50%;
    }
}

@media (max-width: 480px) {
    .batch-section {
        padding: 20px 0;
    }
    
    .batch-section h3 {
        font-size: 18px;
    }
    
    .carousel-wrapper {
        gap: 5px;
    }
    
    .carousel-card {
        min-width: 100%;
    }
    
    .carousel-btn {
        width: 35px;
        height: 35px;
        font-size: 14px;
    }
    
    .whatsapp-ad-card {
        min-height: 320px;
    }
    
    .ad-text {
        padding: 0.5rem;
    }
    
    .ad-text h4 {
        font-size: 0.9rem;
    }
    
    .ad-text p {
        font-size: 0.75rem;
    }
    
    .ad-actions {
        padding: 0.5rem;
    }
    
    .ad-actions p {
        font-size: 0.85rem;
    }
    
    .btn-icon {
        padding: 6px;
        width: 32px;
        height: 32px;
        font-size: 12px;
    }
}
</style>

<script>
let currentIndex = 0;
let cardsPerView = 3;
let totalCards = {% if ads %}{{ ads|length }}{% else %}0{% endif %};

// Initialize carousel
function initCarousel() {
    updateCardsPerView();
    createIndicators();
    updateCarousel();
    
    // Auto-play carousel
    setInterval(() => {
        moveCarousel(1);
    }, 5000);
}

function updateCardsPerView() {
    const width = window.innerWidth;
    if (width < 480) {
        cardsPerView = 1;
    } else if (width < 768) {
        cardsPerView = 2;
    } else {
        cardsPerView = 3;
    }
}

function createIndicators() {
    const indicatorsContainer = document.getElementById('carouselIndicators');
    if (!indicatorsContainer) return;
    
    indicatorsContainer.innerHTML = '';
    const numIndicators = Math.ceil(totalCards / cardsPerView);
    
    for (let i = 0; i < numIndicators; i++) {
        const indicator = document.createElement('div');
        indicator.className = 'indicator' + (i === 0 ? ' active' : '');
        indicator.onclick = () => goToSlide(i);
        indicatorsContainer.appendChild(indicator);
    }
}

function moveCarousel(direction) {
    const maxIndex = Math.ceil(totalCards / cardsPerView) - 1;
    currentIndex += direction;
    
    if (currentIndex < 0) {
        currentIndex = maxIndex;
    } else if (currentIndex > maxIndex) {
        currentIndex = 0;
    }
    
    updateCarousel();
}

function goToSlide(index) {
    currentIndex = index;
    updateCarousel();
}

function updateCarousel() {
    const track = document.getElementById('carouselTrack');
    if (!track) return;
    
    const cardWidth = 300 + 20; // card width + gap
    const offset = -currentIndex * cardWidth * cardsPerView;
    track.style.transform = `translateX(${offset}px)`;
    
    // Update indicators
    const indicators = document.querySelectorAll('.indicator');
    indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === currentIndex);
    });
}

// Modal functions
function showAdModal(adId, images, video, mediaType, title, description, price) {
    const modal = document.getElementById('ad-modal');
    const modalImages = document.getElementById('modal-images');
    const modalDescription = document.getElementById('modal-description');

    modalImages.innerHTML = '';
    if (mediaType === 'video') {
        const videoElement = document.createElement('video');
        videoElement.src = '{{ url_for("static", filename="uploads/") }}' + video;
        videoElement.controls = true;
        videoElement.autoplay = true;
        videoElement.style.maxWidth = '100%';
        videoElement.style.height = 'auto';
        modalImages.appendChild(videoElement);
    } else {
        const imageList = images.split(',');
        imageList.forEach(img => {
            const imgElement = document.createElement('img');
            imgElement.src = '{{ url_for("static", filename="uploads/") }}' + img;
            imgElement.alt = 'Piblisite Imaj';
            modalImages.appendChild(imgElement);
        });
    }

    modalDescription.innerHTML = '<h3>' + title + '</h3><p>' + description + '</p><p><strong>Pri: ' + price + ' Gkach</strong></p>';
    modal.style.display = 'block';
}

function closeAdModal() {
    const modal = document.getElementById('ad-modal');
    modal.style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('ad-modal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}

// Initialize on page load
window.addEventListener('load', initCarousel);
window.addEventListener('resize', () => {
    updateCardsPerView();
    createIndicators();
    updateCarousel();
});
</script>

{% endblock %}
