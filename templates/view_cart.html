{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2>Panier Achte</h2>

    {% if cart_items %}
        <div class="cart-items">
            {% for item in cart_items %}
            <div class="cart-item">
                <div class="item-image">
                    <img src="{{ url_for('static', filename='uploads/' + item.ad.images.split(',')[0]) }}"
                         alt="Piblisite Imaj" style="max-width: 100px; height: auto;">
                </div>
                <div class="item-details">
                    <h4>{{ item.ad.title }}</h4>
                    <p>{{ item.ad.description[:100] }}...</p>
                    <p>Kantite: {{ item.quantity }}</p>
                    <p>Pri Inite: {{ item.ad.price_gkach }} Gkach</p>
                    <p>Sou-Total: {{ item.subtotal }} Gkach</p>
                    {% if item.shipping_fee_set %}
                        <p>Pri Livrezon: {{ item.shipping_fee }} Gkach</p>
                    {% else %}
                        <p>Pri Livrezon: Pa mete</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="cart-summary">
            <h3>Rezime</h3>
            <p>Total Pwodwi: {{ total_price }} Gkach</p>
            <p>Total Livrezon: {% if all_shipping_set %}Mete{% else %}Pa mete pou tout atik{% endif %}</p>
            {% if all_shipping_set %}
                <p><strong>Total Final: {{ total_price + cart_items|sum(attribute='shipping_fee') }} Gkach</strong></p>
                <a href="{{ url_for('shopping_card_update', whatsapp=whatsapp) }}" class="btn btn-primary">Konfime Achte</a>
            {% else %}
                <p>Ou dwe mete pri livrezon pou tout atik anvan konfime acha.</p>
            {% endif %}
        </div>

        <div class="actions">
            <a href="{{ url_for('achte') }}" class="btn btn-secondary">Kontinye Achte</a>
            {% if all_negotiated %}
                <form method="POST" action="{{ url_for('checkout') }}" style="display: inline;">
                    <input type="hidden" name="whatsapp" value="{{ whatsapp }}">
                    <button type="submit" class="btn btn-success">Peye Kounye a</button>
                </form>
            {% else %}
                <p style="color: red;">Ou dwe fini negosyasyon ak vandè a anvan ou ka peye.</p>
            {% endif %}
        </div>
    {% else %}
        <p>Panier ou vid.</p>
        <a href="{{ url_for('achte') }}" class="btn btn-primary">Kòmanse Achte</a>
    {% endif %}
</div>

<style>
.cart-items {
    margin-bottom: 20px;
}

.cart-item {
    display: flex;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background: white;
    gap: 15px;
}

.item-image img {
    border-radius: 4px;
}

.item-details h4 {
    margin: 0 0 10px 0;
}

.item-details p {
    margin: 5px 0;
}

.cart-summary {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    background: #f8f9fa;
    margin-bottom: 20px;
}

.cart-summary h3 {
    margin-top: 0;
}

.actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    text-decoration: none;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    display: inline-block;
}

.btn-primary {
    background-color: #007bff;
    color: white;
}

.btn-primary:hover {
    background-color: #0056b3;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background-color: #545b62;
}

.btn-success {
    background-color: #28a745;
    color: white;
}

.btn-success:hover {
    background-color: #1e7e34;
}
</style>
{% endblock %}
