{% extends "base.html" %}

{% block content %}
<div class="container">
    {% if mode == 'enter_shipping' %}
        <h2>Konfime Achte - Mete Pri Livrezon</h2>

        {% if cart_items %}
            <div class="cart-summary">
                <h3>Rezime Panier</h3>
                {% for item in cart_items %}
                <div class="cart-item-summary">
                    <div class="item-image">
                        <img src="{{ url_for('static', filename='uploads/' + item.ad.images.split(',')[0]) }}"
                             alt="Piblisite Imaj" style="max-width: 80px; height: auto;">
                    </div>
                    <div class="item-details">
                        <h5>{{ item.ad.title }}</h5>
                        <p>Kantite: {{ item.quantity }} | Pri Inite: {{ item.ad.price_gkach }} Gkach</p>
                        <p><strong>Sou-Total: {{ item.subtotal }} Gkach</strong></p>
                    </div>
                </div>
                {% endfor %}
                <div class="total">
                    <h4>Total Pwodwi: {{ total_price }} Gkach</h4>
                </div>
            </div>

            <form method="POST" action="{{ url_for('shopping_card_update', whatsapp=whatsapp) }}">
                <div class="form-group">
                    <label for="delivery_address">Adrès Livrezon:</label>
                    <textarea name="delivery_address" id="delivery_address" class="form-control" rows="4" required
                              placeholder="Antre adrès livrezon konplè ou a...">{{ delivery_address or '' }}</textarea>
                </div>

                <div class="form-group">
                    <label for="shipping_price">Ajoute Pri Livrezon (Gkach):</label>
                    <input type="number" name="shipping_price" id="shipping_price" class="form-control" min="0" step="1" required
                           placeholder="Antre pri livrezon ou pwopoze...">
                </div>

                <div class="form-check">
                    <input type="checkbox" name="accept_terms" id="accept_terms" class="form-check-input" required>
                    <label for="accept_terms" class="form-check-label">
                        Mwen aksepte kondisyon ak règleman yo pou acha sa a.
                    </label>
                </div>

                <button type="submit" class="btn btn-primary">Soumèt Pwopozisyon Livrezon</button>
            </form>

            <div class="actions">
                <a href="{{ url_for('view_cart', whatsapp=whatsapp) }}" class="btn btn-secondary">Retounen nan Panier</a>
            </div>
        {% else %}
            <p>Pa gen atik nan panier ou.</p>
            <a href="{{ url_for('achte') }}" class="btn btn-primary">Kòmanse Achte</a>
        {% endif %}

    {% elif mode == 'waiting_for_seller' %}
        <h2>Atann Vandè - Negosyasyon Livrezon</h2>
        <div class="alert alert-info">
            <p>Ou te soumèt pwopozisyon livrezon ou a. Vandè a pral revize epi mete ajou pri livrezon an.</p>
            <p>Ou pral resevwa yon mesaj WhatsApp lè pri a mete ajou.</p>
        </div>

        {% if cart_items %}
            <div class="cart-summary">
                <h3>Rezime Panier (Pwopozisyon)</h3>
                {% for item in cart_items %}
                <div class="cart-item-summary">
                    <div class="item-image">
                        <img src="{{ url_for('static', filename='uploads/' + item.ad.images.split(',')[0]) }}"
                             alt="Piblisite Imaj" style="max-width: 80px; height: auto;">
                    </div>
                    <div class="item-details">
                        <h5>{{ item.ad.title }}</h5>
                        <p>Kantite: {{ item.quantity }} | Pri Inite: {{ item.ad.price_gkach }} Gkach</p>
                        <p>Pri Livrezon Pwopoze: {{ item.shipping_fee }} Gkach</p>
                        <p><strong>Sou-Total: {{ item.subtotal + item.shipping_fee }} Gkach</strong></p>
                    </div>
                </div>
                {% endfor %}
                <div class="total">
                    <h4>Total Pwopoze: {{ total_price + cart_items|sum(attribute='shipping_fee') }} Gkach</h4>
                </div>
            </div>
        {% endif %}

        <div class="actions">
            <a href="{{ url_for('achte') }}" class="btn btn-secondary">Kontinye Achte</a>
        </div>

    {% elif mode == 'seller_updated' %}
        <h2>Pri Livrezon Mete Ajou - Konfime Achte</h2>
        <div class="alert alert-success">
            <p>Vandè a mete ajou pri livrezon an. Revize detay yo epi konfime acha ou a.</p>
        </div>

        {% if cart_items %}
            <div class="cart-summary">
                <h3>Rezime Panier Final</h3>
                {% for item in cart_items %}
                <div class="cart-item-summary">
                    <div class="item-image">
                        <img src="{{ url_for('static', filename='uploads/' + item.ad.images.split(',')[0]) }}"
                             alt="Piblisite Imaj" style="max-width: 80px; height: auto;">
                    </div>
                    <div class="item-details">
                        <h5>{{ item.ad.title }}</h5>
                        <p>Kantite: {{ item.quantity }} | Pri Inite: {{ item.ad.price_gkach }} Gkach</p>
                        <p>Pri Livrezon: {{ item.shipping_fee }} Gkach</p>
                        <p><strong>Sou-Total: {{ item.subtotal + item.shipping_fee }} Gkach</strong></p>
                    </div>
                </div>
                {% endfor %}
                <div class="total">
                    <h4>Total Final: {{ total_price + cart_items|sum(attribute='shipping_fee') }} Gkach</h4>
                </div>
            </div>

            <div class="actions">
                <form method="POST" action="{{ url_for('checkout') }}" style="display: inline;">
                    <input type="hidden" name="whatsapp" value="{{ whatsapp }}">
                    <button type="submit" class="btn btn-success">Konfime Achte</button>
                </form>
                <a href="{{ url_for('decline_cart', whatsapp=whatsapp) }}" class="btn btn-danger">Refize Achte</a>
                <a href="{{ url_for('achte') }}" class="btn btn-secondary">Kontinye Achte</a>
            </div>
        {% endif %}
    {% endif %}
</div>

<style>
.cart-summary {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    background: #f8f9fa;
    margin-bottom: 20px;
}

.cart-item-summary {
    display: flex;
    align-items: center;
    border-bottom: 1px solid #eee;
    padding: 10px 0;
    gap: 15px;
}

.cart-item-summary:last-child {
    border-bottom: none;
}

.item-image img {
    border-radius: 4px;
}

.item-details h5 {
    margin: 0 0 5px 0;
}

.item-details p {
    margin: 0;
    font-size: 14px;
}

.total {
    text-align: center;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 2px solid #007bff;
}

.form-group {
    margin-bottom: 15px;
}

.form-control {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
}

.form-check {
    margin-bottom: 20px;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 4px;
    text-decoration: none;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    display: inline-block;
    margin-right: 10px;
}

.btn-primary {
    background-color: #007bff;
    color: white;
}

.btn-primary:hover {
    background-color: #0056b3;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background-color: #545b62;
}

.actions {
    margin-top: 20px;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .cart-item-summary {
        flex-direction: column;
        align-items: flex-start;
    }

    .item-image img {
        max-width: 100%;
        height: auto;
    }

    .btn {
        width: 100%;
        margin-bottom: 10px;
        margin-right: 0;
    }

    .actions {
        display: flex;
        flex-direction: column;
    }
}
</style>
{% endblock %}
